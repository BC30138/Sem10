CC=g++
CFLAGS := -std=c++17 -Wall
LDFLAGS=

TOOLSSOURCES=src/tools/TridiagonalSLE.cpp
TOOLSSOURCES+=src/tools/functions.cpp
TOOLSOBJECTS=$(TOOLSSOURCES:.cpp=.o)

ALGSOURCES=src/algorithm/MainAlg.cpp
ALGOBJECTS=$(ALGSOURCES:.cpp=.o)
ALGEXECUTABLE=app/alg.out

MPISOURCES=src/MPI/MainMPI.cpp
MPIOBJECTS=$(MPISOURCES:.cpp=.o)
MPIEXECUTABLE=app/MPIlab.out

OPENMPSOURCES=src/openmp/MainOpenMP.cpp
OPENMPSOURCES+=src/openmp/OpenMPalg.cpp
OPENMPOBJECTS=$(OPENMPSOURCES:.cpp=.o)
OPENMPEXECUTABLE=app/OpenMPlab.out
$(OPENMPOBJECTS): CFLAGS := $(CFLAGS) -fopenmp

PTHREADSOURCES=src/pthreads/MainPthreads.cpp
PTHREADSOURCES+=src/pthreads/PthreadsAlg.cpp
PTHREADOBJECTS=$(PTHREADSOURCES:.cpp=.o)
PTHREADEXECUTABLE=app/pthreadslab.out
$(PTHREADOBJECTS): CFLAGS := $(CFLAGS) -pthread

alg: $(ALGSOURCES) $(TOOLSSOURCES) $(ALGEXECUTABLE)

$(ALGEXECUTABLE): $(ALGOBJECTS) $(TOOLSOBJECTS)
	$(CC) $(LDFLAGS) $(ALGOBJECTS) $(TOOLSOBJECTS) -o $@

MPI: $(MPISOURCES) $(TOOLSSOURCES) $(MPIEXECUTABLE)

$(MPIEXECUTABLE): $(MPIOBJECTS) $(TOOLSOBJECTS)
	$(CC) $(LDFLAGS) $(MPIOBJECTS) $(TOOLSOBJECTS) -o $@

openmp: $(OPENMPSOURCES) $(TOOLSSOURCES) $(OPENMPEXECUTABLE)

$(OPENMPEXECUTABLE): $(OPENMPOBJECTS) $(TOOLSOBJECTS)
	$(CC) $(LDFLAGS) -fopenmp $(OPENMPOBJECTS) $(TOOLSOBJECTS) -o $@

pthreads: $(PTHREADSOURCES) $(TOOLSSOURCES) $(PTHREADEXECUTABLE)

$(PTHREADEXECUTABLE): $(PTHREADOBJECTS) $(TOOLSOBJECTS)
	$(CC) $(LDFLAGS) -pthread $(PTHREADOBJECTS) $(TOOLSOBJECTS) -o $@

.cpp.o:
	$(CC) $(CFLAGS) $< -c -o $@

clean:
	rm -rf $(ALGOBJECTS) $(ALGEXECUTABLE) $(MPIOBJECTS) $(MPIEXECUTABLE) $(OPENMPOBJECTS) $(OPENMPEXECUTABLE) $(PTHREADOBJECTS) $(PTHREADEXECUTABLE) $(TOOLSOBJECTS)